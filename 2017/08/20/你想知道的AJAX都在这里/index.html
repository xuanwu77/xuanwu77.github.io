<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="AJAX,HTTP,跨域,状态码," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon1.ico?v=5.1.1" />






<meta name="description" content="这篇文章主要是记录下慕课网上的AJAX全接触这门课，又在某些地方补充了些知识。下面直接进主题！ AJAX 是Asychronous Javascript and XML的英文简写。先纠正一下英文发音：[ˈeɪˌdʒæks]，毕竟这样才是最地道的。 Ajax不是一种编程语言，而是一种无需重新加载整个网页的情况之下能够更新部分网页的技术。 为什么这么说？ 因为在ajax出现之前，想要更新内容或者提交一">
<meta name="keywords" content="AJAX,HTTP,跨域,状态码">
<meta property="og:type" content="article">
<meta property="og:title" content="你想知道的AJAX都在这里">
<meta property="og:url" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/index.html">
<meta property="og:site_name" content="Xuan&#39;s Blog">
<meta property="og:description" content="这篇文章主要是记录下慕课网上的AJAX全接触这门课，又在某些地方补充了些知识。下面直接进主题！ AJAX 是Asychronous Javascript and XML的英文简写。先纠正一下英文发音：[ˈeɪˌdʒæks]，毕竟这样才是最地道的。 Ajax不是一种编程语言，而是一种无需重新加载整个网页的情况之下能够更新部分网页的技术。 为什么这么说？ 因为在ajax出现之前，想要更新内容或者提交一">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/AJAX之前.png">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/AJAX之后.png">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/HTTP请求报文.png">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/请求格式.png">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/HTTP响应报文.png">
<meta property="og:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/域名地址.png">
<meta property="og:updated_time" content="2017-08-21T09:14:36.992Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你想知道的AJAX都在这里">
<meta name="twitter:description" content="这篇文章主要是记录下慕课网上的AJAX全接触这门课，又在某些地方补充了些知识。下面直接进主题！ AJAX 是Asychronous Javascript and XML的英文简写。先纠正一下英文发音：[ˈeɪˌdʒæks]，毕竟这样才是最地道的。 Ajax不是一种编程语言，而是一种无需重新加载整个网页的情况之下能够更新部分网页的技术。 为什么这么说？ 因为在ajax出现之前，想要更新内容或者提交一">
<meta name="twitter:image" content="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/AJAX之前.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/"/>





  <title>你想知道的AJAX都在这里 | Xuan's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xuan's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">^每天务必做一点你所不愿意做的事情^</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于Me
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/20/你想知道的AJAX都在这里/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wu Xuan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xuan's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">你想知道的AJAX都在这里</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-20T18:12:38+08:00">
                2017-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              



              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/08/20/你想知道的AJAX都在这里/" class="leancloud_visitors" data-flag-title="你想知道的AJAX都在这里">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  4,249
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这篇文章主要是记录下慕课网上的AJAX全接触这门课，又在某些地方补充了些知识。下面直接进主题！</p>
<p>AJAX 是Asychronous Javascript and XML的英文简写。先纠正一下英文发音：[ˈeɪˌdʒæks]，毕竟这样才是最地道的。</p>
<p>Ajax<strong>不是一种编程语言</strong>，而是一种无需重新加载整个网页的情况之下能够<strong>更新部分网页的技术</strong>。</p>
<p><strong>为什么这么说？</strong></p>
<p>因为在ajax出现之前，想要更新内容或者提交一个表单，就要重新载入页面；</p>
<a id="more"></a>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/AJAX之前.png" alt="AJAX之前"></p>
<p>而使用了ajax技术的网页，通过在后台跟服务器进行少量的数据交换，网页就可以实现异步局部更新。</p>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/AJAX之后.png" alt="AJAX之后"></p>
<h3 id="XMLHttpRequest对象"><a href="#XMLHttpRequest对象" class="headerlink" title="XMLHttpRequest对象"></a>XMLHttpRequest对象</h3><p>AJAX能够实现这种异步的传输，主要是因为一个对象的出现  <strong>XMLHttpRequest</strong>，下面将它简称为<strong>XHR对象</strong>。</p>
<p>实例化一个<code>XHR</code>对象(IE7及更高版本)：</p>
<p><code>var xhr =  new XMLHttpRequest();</code></p>
<p>为了兼容低版本IE5/6这些浏览器，可以做个兼容性处理，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xhr;</div><div class="line"><span class="keyword">if</span>(windo.XMLHttpRequest)&#123;</div><div class="line">  xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">//IE7+,Firefox,Chrome,Opera,Safari</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">  xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>);   <span class="comment">//IE6,IE5</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不过现在IE6或更早的浏览器也不怎么需要考虑了，所以也可以直接用前面的那种常用方法实现了。</p>
<p>创建完xhr对象后，我们就可以使用它来发送请求了，先讲一下什么是HTTP请求吧!</p>
<h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h3><p>HTTP是计算机通过网络进行通信的规则，一个完整的HTTP请求通常包含以下几个步骤：</p>
<ul>
<li>1.建立TCP连接</li>
<li>2.Web浏览器向Web服务器发送请求命令</li>
<li>3.web浏览器发送请求头信息</li>
<li>4.Web服务器应答</li>
<li>5.Web服务器发送应答头信息</li>
<li>6.Web服务器向浏览器发送数据</li>
<li>7.Web服务器关闭TCP连接</li>
</ul>
<h4 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h4><p>一个<strong>HTTP请求</strong>一般由四部分组成（可以结合HTTP请求报文的图来看）：</p>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/HTTP请求报文.png" alt="HTTP请求报文"></p>
<ul>
<li>1.HTTP<strong>请求的方法</strong>或动作，比如是GET还是POST请求；</li>
<li>2.正在请求的<strong>URL</strong>，即请求的地址；</li>
<li>3.<strong>请求头</strong>，包含一些客户端环境信息，身份验证信息等；</li>
<li>4.<strong>请求体</strong>，也就是请求正文，可以包含客户提交的查询字符串信息，表单信息等。（请求头和请求体之间有一个空行很重要，它表示请求头结束了，接下来是请求体）</li>
</ul>
<p>下面给出真实的请求报文的一个例子，分出了请求头和请求体：</p>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/请求格式.png" alt="HTTP请求格式"></p>
<p>HTTP请求的默认方法是GET，由于它用于获取信息，而不是修改信息，从这个角度来说，GET是安全的。但是要注意，通过GET发送的信息对任何人都是可见的，因为 所有的变量名和值都显示在url中，即使用url传递参数（以上例子中用GET方法发送用户名和密码其实是不可取的），正因如此，所以发送信息的数量是受限的。虽然是明文，任何人都可见，但也有好处，我们可以添加在书签里，之后就可以使用。</p>
<p><strong>GET 与POST的区别总结为:</strong></p>
<ul>
<li><strong>GET</strong> <ul>
<li>一般用于信息获取</li>
<li>使用URL来传递参数</li>
<li>​对所发送信息的数量也有限制，一般在2000个字符       </li>
</ul>
</li>
<li><strong>POST</strong><ul>
<li>一般用于修改服务器上的资源<ul>
<li>对所发送信息的数量没有限制     </li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>幂等</strong></p>
<p>此外我们还经常听到GET是<strong>幂等</strong>的，何为幂等?</p>
<p>其实也很简单，一个get请求执行一次和执行万次，效果都是一样的，也就是影响是相同的。比如，从数据库库里查询一个员工的信息，该员工信息不会因你查询的次数多少而改变。</p>
<h4 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h4><p>一个<strong>HTTP响应</strong>一般由三部分组成（可以结合HTTP响应报文的图来看）：</p>
<ul>
<li><p><strong>状态码和状态码描述</strong>，用来显示请求时成功还是失败；</p>
</li>
<li><p><strong>响应头</strong>，和请求头一样都要包含许多有用信息，例如服务器类型、日期时间、内容类型和长度等；</p>
</li>
<li><p><strong>响应体</strong>，也就是响应正文。</p>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/HTTP响应报文.png" alt="HTTP响应报文"></p>
</li>
</ul>
<p><strong>状态码</strong>也是很重要的东西，经常被拿来作为考点。根据状态码首数字的而不同，将状态码分为几大类：</p>
<ul>
<li>1xx：信息类，表示收到Web浏览器请求，正在进一步的处理中 。</li>
<li>2xx：成功，表示用户请求被正确接收，理解和处理。</li>
<li>3xx：重定向，表示请求没有成功，客户必须采取进一步的动作。</li>
<li>4xx：客户端错误，表示客户端提交的请求有错误。</li>
<li>5xx：服务器端错误，表示服务器不能完成对请求的处理。</li>
</ul>
<p>附上常见的状态码及对应的解释，如下：</p>
<ul>
<li>100    Continue  ：  继续，一般在发送post请求时，已发送了http header之后服务端将返回此信息，表示确    认，之后发送具体参数信息</li>
<li>200      OK         ：  正常返回信息</li>
<li>201   Created    ：请求成功并且服务器创建了新的资源</li>
<li>202   Accepted ：服务器已接受请求，但尚未处理</li>
<li>301   Moved Permanently ：请求的网页已永久移动到新位置。</li>
<li>302    Found   ： 临时性重定向。</li>
<li>303   See Other ： 临时性重定向，且总是使用 GET 请求新的 URI。</li>
<li>304    Not Modified ： 自从上次请求后，请求的网页未修改过。</li>
<li>400   Bad Request   ：服务器无法理解请求的格式，客户端不应当尝试再次使用相同的内容发起请求。</li>
<li>401    Unauthorized   ：请求未授权。</li>
<li>403    Forbidden   ：禁止访问。</li>
<li>404    Not Found      ：找不到与 URI 相匹配的资源。</li>
<li>500    Internal Server Error  ： 最常见的服务器端错误。</li>
<li>503    Service Unavailable    ：服务器端暂时无法处理请求（可能是过载或维护）。</li>
</ul>
<h3 id="XHR对象发送请求"><a href="#XHR对象发送请求" class="headerlink" title="XHR对象发送请求"></a>XHR对象发送请求</h3><p>如何用XHR发送请求？</p>
<ul>
<li>open(方法,url,是否异步);     //注： 异步为true，同步为false</li>
<li>send(string);</li>
</ul>
<p>get方法时，send中参数为空或为null，post方法时一般要send内容，如果不send任何东西，也就没什么意义了。</p>
<p><strong>拓展</strong>：xhr除了有以上open()和send()两种方法，还有其他几种方法，以下罗列出来：</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">open(method,url,async)</td>
<td style="text-align:center">设置HTTP方法(get 或 post)等</td>
</tr>
<tr>
<td style="text-align:center">send(content)</td>
<td style="text-align:center">发出带有指定主体内容的请求</td>
</tr>
<tr>
<td style="text-align:center">getAllReaponseHeaders()</td>
<td style="text-align:center">获取所有的响应报头</td>
</tr>
<tr>
<td style="text-align:center">getReaponseHeader(name)</td>
<td style="text-align:center">查询响应中的某个字段的值</td>
</tr>
<tr>
<td style="text-align:center">setRequestHeader(name,value)</td>
<td style="text-align:center">使用指定的名称和值设置请求头</td>
</tr>
<tr>
<td style="text-align:center">abort()</td>
<td style="text-align:center">取消当前正在执行的请求</td>
</tr>
</tbody>
</table>
<h3 id="如何获取服务器-的响应？"><a href="#如何获取服务器-的响应？" class="headerlink" title="如何获取服务器 的响应？"></a>如何获取服务器 的响应？</h3><p>服务器响应回的数据会自动填充XHR对象的属性：</p>
<ul>
<li>responseText  : 获取字符串形式的响应数据；</li>
<li>responseXML :  获得XML形式的响应数据（用XML形式获取响应数据现在用的少，最常用的还是JSON格式，后面介绍）；</li>
<li>status和statusText : 以数字和文本形式返回HTTP状态码。</li>
</ul>
<p>想知道一个服务器响应有没有完成，就需要监听<strong>readyState</strong>这个属性的变化，它的取值有如下几种：</p>
<ul>
<li>0：请求未初始化，open()方法还没调用；</li>
<li>1：启动。open()已经调用，但尚未调用send()方法；</li>
<li>2：发送。已经调用send()方法，但尚未接收到响应；</li>
<li>3：接收。已经收到部分响应数据；</li>
<li>4：完成。已经接收到全部响应数据，而且已经可以在客户端使用了。</li>
</ul>
<p>很明显，我们只要关注<code>readyState</code>为<code>4</code>时的情况，因为此时已经接收到全部响应数据，而且已经可以在客户端使用了。实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"><span class="comment">//在open()方法调用前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性</span></div><div class="line">xh.onreadystatechange =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">//响应完成且请求成功时做一些事情</span></div><div class="line">  <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)&#123;   </div><div class="line">     <span class="comment">//用xhr.responseText做一些事</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">xhr.open(<span class="string">"GET"</span>,<span class="string">"get.php"</span>,<span class="literal">true</span>);</div><div class="line">xhr.send();</div></pre></td></tr></table></figure>
<p><strong>所以简单总结下整个过程就是：</strong></p>
<p>实例化一个XHR对象，调用他的open方法，send一些数据，对这个过程进行监听，以知道服务器是否做出了正确的响应，接着我们就可以做一些事情，比如获取响应得到的数据，做一些数据展示。</p>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p>在实际开发中，前后端通常使用JSON来进行数据交互——<strong>JSON</strong>（JavaScript Object Notation，JavaScript对象表示法）：</p>
<ul>
<li>是存储和交换文本信息的数据格式，类似于XML。它采用键值对的方式来组织，易于阅读和编写，同时也易于机器解析和生成；</li>
<li>是独立于语言的，任何语言都可以解析json，只需要按照json的规则来就行。</li>
</ul>
<h4 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h4><p>JSON的语法可以是<strong>简单值</strong>（五种基本类型中除去undefined）、<strong>对象</strong>、<strong>数组</strong>。</p>
<p>下面主要讲JSON对象，先给个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"staff"</span> : [</div><div class="line">    &#123;<span class="string">"name"</span> : <span class="string">"洪七"</span>, <span class="string">"age"</span> : <span class="number">70</span>&#125;</div><div class="line">    &#123;<span class="string">"name"</span> : <span class="string">"郭靖"</span>, <span class="string">"age"</span> : <span class="number">35</span>&#125;</div><div class="line">    &#123;<span class="string">"name"</span> : <span class="string">"黄蓉"</span>, <span class="string">"age"</span> : <span class="number">30</span>&#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个例子中只有 一个<code>staff</code>属性，属性值是一个数组，该数组包含了3个对象，每个对象又包含了两个相同的属性<code>name</code>和<code>age</code>。</p>
<p>写法和js对象的写法很相似，但要注意<strong>不同点</strong>：</p>
<ul>
<li>JSON对象没有声明变量，末尾没有分号；</li>
<li>JSON对象中的属性名在任何时候都必须加<strong>双引号</strong><code>&quot;&quot;</code></li>
</ul>
<h4 id="JSON解析与序列化"><a href="#JSON解析与序列化" class="headerlink" title="JSON解析与序列化"></a>JSON解析与序列化</h4><ul>
<li><p>JSON.parse(): 把JSON字符串解析为JS对象</p>
</li>
<li><p>JSON.stringify() : 把JS对象序列化为JSON字符串</p>
</li>
</ul>
<h4 id="JSON-与-XML的比较："><a href="#JSON-与-XML的比较：" class="headerlink" title="JSON 与 XML的比较："></a>JSON 与 XML的比较：</h4><ul>
<li>1.JSON 的长度和XML格式比起来很短小，读写速度更快</li>
<li>2.JSON 对数据的描述性比XML较差</li>
<li>3.JSON 可以使用javascript内建的方法直接进行解析，转化成javascript对象</li>
</ul>
<h3 id="jQuery中的AJAX"><a href="#jQuery中的AJAX" class="headerlink" title="jQuery中的AJAX"></a>jQuery中的AJAX</h3><p>jQuery.ajax({settings})，常用的settings如下：</p>
<ul>
<li>type  : 类型，”POST“ 或 ”GET”，默认为“GET”</li>
<li>url : 发送请求的地址</li>
<li>data : 是一个对象，连同请求发送给服务器的数据</li>
<li>dataType:  预期服务器返回的数据类型。如果不指定，JQuery将自动根据HTTP包MIME信息来智能判断，一般我们采用JSON格式，可以设置为“json”。可用类型有: <code>XML</code>,<code>HTML</code>,<code>JSON</code>,<code>JSONP</code>,<code>script</code>,<code>text</code></li>
<li>success : 是一个方法，请求成功后的回调函数，传入返回后的数据，以及包含成功代码的字符串</li>
<li>error: 是一个方法，请求失败时调用此函数，传入XMLHttpRequest对象</li>
</ul>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">	$(<span class="string">"#search"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">		$.ajax(&#123; </div><div class="line">		    <span class="attr">type</span>: <span class="string">"GET"</span>, 	</div><div class="line">			<span class="attr">url</span>: <span class="string">"http://127.0.0.1:8080/ajaxdemo/serverjson2.php?number="</span> + $(<span class="string">"#keyword"</span>).val(),</div><div class="line">			<span class="attr">dataType</span>: <span class="string">"json"</span>,</div><div class="line">			<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				<span class="keyword">if</span> (data.success) &#123; </div><div class="line">					$(<span class="string">"#searchResult"</span>).html(data.msg);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					$(<span class="string">"#searchResult"</span>).html(<span class="string">"出现错误："</span> + data.msg);</div><div class="line">				&#125;  </div><div class="line">			&#125;,</div><div class="line">			<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR</span>)</span>&#123;     </div><div class="line">			   alert(<span class="string">"发生错误："</span> + jqXHR.status);  </div><div class="line">			&#125;,     </div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为上面代码用到了<code>$(document).ready()</code> ，所以这里补充个知识，</p>
<p>jQuery中<code>$(document).ready()</code>和原生JS中<code>window.onload</code>的<strong>区别</strong>：</p>
<p>两者方法功能类似，但在执行时机方面有区别。<code>window.onload</code>是在网页中素有元素（包括元素的所有关联文件）完全加载到浏览器后才执行，即javascript此时才可以访问页面中的任何元素。而<code>$(document).ready()</code>注册的事件处理程序在DOM完全就绪时就可以被调用，不必等到所有关联文件全部下载完毕。很显然，把网页解析为DOM树的速度比把页面中的所有关联文件加载完毕的速度快很多。此外，<code>$(document).ready()</code>可以出现多次，按照注册的顺序依次执行，而<code>window.onload</code>一次只能保存对一个函数的引用，即后面出现的会覆盖前面的。</p>
<p>另外：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//可以简写成 </span></div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//$()不带参数时，默认参数就是“document”,所以也可以简写成</span></div><div class="line">$().ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><p>URL的组成：</p>
<p><img src="/2017/08/20/你想知道的AJAX都在这里/域名地址.png" alt="域名地址"></p>
<p>当协议、域名（主域名、子域名）、端口号中有一个不相同时，都算作不同域。</p>
<p>上例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">www.abc.com/index.html 调用 www.abc.com/service.php  (非跨域)</div><div class="line">www.abc.com/index.html 调用 www.efg.com/service.php  (跨域,域名不同)</div><div class="line">www.abc.com/index.html 调用 bbs.abc.com/service.php  (跨域，子域名不同)</div><div class="line">www.abc.com/index.html 调用 www.abc.com:<span class="number">81</span>/service.php  (跨域，端口号不同)</div><div class="line">www.abc.com/index.html 调用 https:<span class="comment">//www.abc.com/service.php  (跨域,协议不同)</span></div></pre></td></tr></table></figure>
<p>不同域之间相互请求资源，就叫做“<strong>跨域</strong>”。Javascipt处于安全方面的考虑，不允许跨域调用其他页面的对象。在安全限制的同时给注入iframe或者ajax应用带来不便，AJAX本身是不支持跨域访问的，那有什么方法可以实现跨域访问呢？</p>
<p><strong>处理跨域的方法</strong></p>
<h4 id="服务器代理"><a href="#服务器代理" class="headerlink" title="服务器代理"></a>服务器代理</h4><p>基本原理就是，由客户端将请求发给本域服务器，再由本域服务器上的代理(php)来请求数据并将响应返回给客户端，这样客户端调用本域的服务就和调用跨域的服务效果相同了。</p>
<h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a><strong>JSONP</strong></h4><ul>
<li>该方法是借助了<code>script</code> 标签可以跨域去访问的特性。因为通过script标签引入的js是不受同源策略的限制的，所以我们可以通过script标签引入一个js或者是一个其他后缀形式（如php，jsp等）的文件，此文件返回一个js函数的调用，该方法与AJAX中的XHR对象没有太大关系。</li>
</ul>
<ul>
<li><p>jQuery中的AJAX本身就支持JSONP的跨域方法，看一下如何使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">	$(<span class="string">"#search"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">		$.ajax(&#123; </div><div class="line">		    <span class="attr">type</span>: <span class="string">"GET"</span>, 	</div><div class="line">			<span class="attr">url</span>: <span class="string">"http://127.0.0.1:8000/ajaxdemo/serverjsonp.php?number="</span> + $(<span class="string">"#keyword"</span>).val(),</div><div class="line">			<span class="attr">dataType</span>: <span class="string">"jsonp"</span>,  <span class="comment">//dataType从"json"改为“jsonp”</span></div><div class="line">			jsonp: <span class="string">"callback"</span>,<span class="comment">//添加一个jsonp属性</span></div><div class="line">			success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				<span class="keyword">if</span> (data.success) &#123;</div><div class="line">					$(<span class="string">"#searchResult"</span>).html(data.msg);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					$(<span class="string">"#searchResult"</span>).html(<span class="string">"出现错误："</span> + data.msg);</div><div class="line">				&#125;  </div><div class="line">			&#125;,</div><div class="line">			<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR</span>)</span>&#123;     </div><div class="line">			   alert(<span class="string">"发生错误："</span> + jqXHR.status);  </div><div class="line">			&#125;,     </div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">  );</div></pre></td></tr></table></figure>
<p>服务器端：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过员工编号搜索员工</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span><span class="params">()</span></span>&#123;</div><div class="line">	$jsonp = $_GET[<span class="string">"callback"</span>]; <span class="comment">// 和上边的“callback”对应</span></div><div class="line">	<span class="comment">//检查是否有员工编号的参数</span></div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">"number"</span>]) ||<span class="keyword">empty</span>($_GET[<span class="string">"number"</span>])&#123;</div><div class="line">		<span class="keyword">echo</span> $jsonp . <span class="string">'(&#123;"success":false,"msg":"参数错误"&#125;)'</span>;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">global</span> $staff;</div><div class="line">	<span class="comment">//获取number参数</span></div><div class="line">	$number = $_GET[<span class="string">"number"</span>];</div><div class="line">	$result = $jsonp . <span class="string">'(&#123;"success":false,"msg":"没有找到员工。"&#125;)'</span>;</div><div class="line">	<span class="comment">//遍历$staff多维数组，查找key值为number的员工是否存在，如果存在，则修改返回结果</span></div><div class="line">	<span class="keyword">foreach</span> ($staff <span class="keyword">as</span> $value) &#123;</div><div class="line">		<span class="keyword">if</span> ($value[<span class="string">"number"</span>] == $number) &#123;</div><div class="line">			$result = $jsonp . <span class="string">'(&#123;"success":true,"msg":"找到员工：员工编号：'</span> . $value[<span class="string">"number"</span>] .</div><div class="line">			      <span class="string">'，员工姓名：'</span> . $value[<span class="string">"name"</span>] . </div><div class="line">				 <span class="string">'，员工性别：'</span> . $value[<span class="string">"sex"</span>] . </div><div class="line">			      <span class="string">'，员工职位：'</span> . $value[<span class="string">"job"</span>] . <span class="string">'"&#125;)'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">    <span class="keyword">echo</span> $result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="跨域源资源共享（CORS）"><a href="#跨域源资源共享（CORS）" class="headerlink" title="跨域源资源共享（CORS）"></a><strong>跨域源资源共享（CORS）</strong></h4><ul>
<li><p>服务器端对于CORS的支持，主要是通过 Access-Control-Allow-Origin来进行的，如果浏览器检测到相应的位置，就可以允许AJAX进行跨域访问。</p>
</li>
<li><p>以php写的后端代码为例，添加服务器头部信息 :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">header(<span class="string">'Access-Control-Allow-Origin:*'</span>);   <span class="comment">//*表示所有域都可以访问，当然我们也可以设置为一个特定的域名</span></div><div class="line">header(<span class="string">'Access-Control-Allow-Methods:POST,GET'</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>CORS和JSONP对比：</strong></p>
<ul>
<li>JSONP只能实现GET请求，而CORS支持所有类型的HTTP请求。</li>
<li>JSONP兼容性好，在更古老的浏览器中都可以运行。CORS方法兼容性不够好,在IE10以下的浏览器不支持。</li>
</ul>
<h4 id="document-domain"><a href="#document-domain" class="headerlink" title="document.domain"></a><strong>document.domain</strong></h4><ul>
<li><p>document.domain可以用来获取当前网页的域名。</p>
</li>
<li><p>采用这种方法的前提是： 这两个域名必须属于同一个基础域名!而且所用的协议，端口都要一致，否则无法利用document.domain进行跨域。</p>
</li>
<li><p>需要注意的是，这种方式只能用在父、子页面之中，即只有在用iframe进行数据访问时才有用。例如，现有两个域名：</p>
<p><code>aaa.xxx.com</code><br><code>bbb.xxx.com</code></p>
<p>aaa里的一个网页（<code>a.html</code>）引入了bbb 里的一个网页（<code>b.html</code>），这时a.html是不能访问b.html里面的内容的。因为两个网页的<code>document.domain</code>不一样，一个是<code>aaa.xxx.com</code>，另一个是<code>bbb.xxx.com</code>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;script type="text/javascript"&gt;</div><div class="line">    function test()&#123;</div><div class="line">        var iframe = document.getElementById('￼ifame');</div><div class="line">        var win = document.contentWindow;//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的</div><div class="line">        var doc = win.document;//获取不到iframe里的document对象</div><div class="line">        var name = win.name;//也获取不到window对象的name属性</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;iframe id = "iframe" src="http://bbb.xxx.com/b.html" onload = "test()"&gt;&lt;/iframe&gt;</div></pre></td></tr></table></figure>
<p>但通过js将<code>a.html</code>里与<code>b.html</code>里的<code>document.domain</code>改成一样的，就可以实跨域操作，实现方法是在<code>a.html</code>里与<code>b.html</code>里都加入：</p>
<p><code>document.domain = &quot;xxx.com&quot;;</code></p>
</li>
</ul>
<h4 id="使用window-name进行跨域"><a href="#使用window-name进行跨域" class="headerlink" title="使用window.name进行跨域"></a><strong>使用window.name进行跨域</strong></h4><p>在一个窗口（window）的生命周期内，窗口载入的所有页面都是共享一个window.name属性的，每一个页面都对window.name有读写权限，所以通过这个属性能够实现不同域间的相互访问，该方法兼容性好。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本篇博文重点是讲述AJAX以及补充了一些涉及到的边角知识点，将HTTP的东西放在本文中讲了，所以篇幅有点多，我自己都快看不下去了，汗汗！我以后把它当字典查了！</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="http://web.jobbole.com/88519/" target="_blank" rel="external">前端跨域知识总结</a></p>
<p><a href="https://segmentfault.com/a/1190000000691919" target="_blank" rel="external">JavaScript学习总结（七）Ajax和Http状态字</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/AJAX/" rel="tag"># AJAX</a>
          
            <a href="/tags/HTTP/" rel="tag"># HTTP</a>
          
            <a href="/tags/跨域/" rel="tag"># 跨域</a>
          
            <a href="/tags/状态码/" rel="tag"># 状态码</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/05/眼神锁定this对象/" rel="next" title="眼神锁定this对象">
                <i class="fa fa-chevron-left"></i> 眼神锁定this对象
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Wu Xuan" />
          <p class="site-author-name" itemprop="name">Wu Xuan</p>
           
              <p class="site-description motion-element" itemprop="description">每天务必做一点你所不愿意做的事情</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xuanwu77" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5247739197" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wu-xuan-0707" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-hand-o-right"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
      
        
      
        

       <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=16780426&auto=0&height=66"></iframe>

      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#XMLHttpRequest对象"><span class="nav-number">1.</span> <span class="nav-text">XMLHttpRequest对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP请求"><span class="nav-number">2.</span> <span class="nav-text">HTTP请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#请求"><span class="nav-number">2.1.</span> <span class="nav-text">请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#响应"><span class="nav-number">2.2.</span> <span class="nav-text">响应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XHR对象发送请求"><span class="nav-number">3.</span> <span class="nav-text">XHR对象发送请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何获取服务器-的响应？"><span class="nav-number">4.</span> <span class="nav-text">如何获取服务器 的响应？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON"><span class="nav-number">5.</span> <span class="nav-text">JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#语法规则"><span class="nav-number">5.1.</span> <span class="nav-text">语法规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON解析与序列化"><span class="nav-number">5.2.</span> <span class="nav-text">JSON解析与序列化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON-与-XML的比较："><span class="nav-number">5.3.</span> <span class="nav-text">JSON 与 XML的比较：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jQuery中的AJAX"><span class="nav-number">6.</span> <span class="nav-text">jQuery中的AJAX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跨域"><span class="nav-number">7.</span> <span class="nav-text">跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#服务器代理"><span class="nav-number">7.1.</span> <span class="nav-text">服务器代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSONP"><span class="nav-number">7.2.</span> <span class="nav-text">JSONP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#跨域源资源共享（CORS）"><span class="nav-number">7.3.</span> <span class="nav-text">跨域源资源共享（CORS）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#document-domain"><span class="nav-number">7.4.</span> <span class="nav-text">document.domain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用window-name进行跨域"><span class="nav-number">7.5.</span> <span class="nav-text">使用window.name进行跨域</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考链接"><span class="nav-number">9.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wu Xuan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("uWzCrxhwzQX1zqyCM5w2t1hJ-gzGzoHsz", "h4IHjBvsAmvRtqHOaJMpI79W");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
